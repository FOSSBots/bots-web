<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8"/>
<title>Documentation - ZppixBot</title>
<link rel="stylesheet" href="css/common.css">
<div class="topnav">
  <a href="index.html">Home</a>
  <a class="active" href="documentation.html">Documentation</a>
  <a href="contribs.html">Contributors</a>
  <a href="about.html">About</a>
  <a href="wiki/index.php/Source_Code">Source Code</a>
   <a href="deploy.html">Deployers' Guide</a>
</div>
    <h1>Table of contents</h1>
    <ol>
      <li><a href="#commands-list">List of commands</a></li>
      <li><a href="#module-development">Module Development</a></li>
      <li><a href="#managing-bot">Managing the bot (for maintainers)</a></li>
        <li><ol>
           <li><a href="#restarting-bot">Restarting the bot</a></li>
           <li><a href="#changing-modules">Making changes to modules</a></li>
           <li><a href="#config-changes">Making config changes</a></li>
           <li><a href="#cancel-reminder">Canceling a reminder</a></li>
           <li><a href="#update-website">Updating the website for ZppixBot</a></li>
        </ol></li>
    </ol>
    <h1 id="commands-list">List of commands</h1>
    <table>
        <thead>
            <tr>
                <th>Commands</th>
                <th>Purpose</th>
                <th>Example</th>
                <th>Module</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>.accesslevel</td>
                <td>Shows what level of access you have.</td>
                <td>.accesslevel Example</td>
                <td>adminlist</td>
            </tr>
            <tr>
                <td>.ban</td>
                <td>Allows you to ban a user from the channel you are in</td>
                <td>.ban Example</td>
                <td>channelmgmt</td>
            </tr>
            <tr>
                <td>.blocks</td>
                <td>Manage ZppixBot&#39;s blocking features.<br /><a href="https://github.com/sopel-irc/sopel/wiki/Making-Sopel-ignore-people">https://github.com/sopel-irc/sopel/wiki/Making-Sopel-ignore-people</a></td>
                <td>.blocks add nick somenickhere</td>
                <td>coretasks</td>
            </tr>
            <tr>
                <td>.c</td>
                <td>Google calculator.</td>
                <td>.c 5 + 3</td>
                <td>calc</td>
            </tr>
            <tr>
                <td>.chairs</td>
                <td>Set the meeting chairs.<br /><a href="https://github.com/sopel-irc/sopel/wiki/Using-the-meetbot-module">https://github.com/sopel-irc/sopel/wiki/Using-the-meetbot-module</a></td>
                <td>.chairs Tyrope Jason elad</td>
                <td>meetbot</td>
            </tr>
            <tr>
                <td>.commands</td>
                <td>Return a list of ZppixBot&#39;s commands</td>
                <td>.commands</td>
                <td>help</td>
            </tr>
            <tr>
                <td>.duck</td>
                <td>Queries Duck Duck Go for the specified input.</td>
                <td>.duck wikipedia</td>
                <td>search</td>
            </tr>
            <tr>
                <td>.endmeeting</td>
                <td>End a meeting.<br /><a href="https://github.com/sopel-irc/sopel/wiki/Using-the-meetbot-module">https://github.com/sopel-irc/sopel/wiki/Using-the-meetbot-module</a></td>
                <td>.endmeeting</td>
                <td>meetbot</td>
            </tr>
            <tr>
                <td>.ety</td>
                <td>Look up the etymology of a word</td>
                <td>.ety word</td>
                <td>etymology</td>
            </tr>
            <tr>
                <td>.countdown</td>
                <td>
                    .countdown &lt;year&gt; &lt;month&gt; &lt;day&gt;
                    - displays a countdown to a given date.
                </td>
                <td>.countdown 2019 09 01</td>
                <td>countdown</td>
            </tr>
            <tr>
                <td>.tld</td>
                <td>Show information about the given Top Level Domain.</td>
                <td>.tld .com</td>
                <td>tld</td>
            </tr>
            <tr>
                <td>.task</td>
                <td>Gives a link to the specified task on Miraheze Phabricator</td>
                <td>.task 1</td>
                <td>mh_phab</td>
            </tr>
            <tr>
                <td>.iplookup<br />.ip</td>
                <td>IP Lookup tool</td>
                <td>.iplookup 8.8.8.8</td>
                <td>ip</td>
            </tr>
            <tr>
                <td>.isup</td>
                <td>isup.me website status checker</td>
                <td>.isup miraheze.org</td>
                <td>isup</td>
            </tr>
            <tr>
                <td>.kick</td>
                <td>Kick a user from the channel.</td>
                <td>.kick example reason</td>
                <td>channelmgmt</td>
            </tr>
            <tr>
                <td>.in</td>
                <td>Gives you a reminder in the given amount of time.</td>
                <td>.in 3h45m Release a new version of ZppixBot</td>
                <td>reminders</td>
            </tr>
            <tr>
                <td>.at</td>
                <td>Gives you a reminder at the given time. Time format: hh:mm:ss. To see what timezone is used, type .getchanneltz (if setting a reminder in a IRC channel) or .gettz (elsewhere)</td>
                <td>.at 13:47 Update the servers!</td>
                <td>reminders</td>
            </tr>
            <tr>
                <td>.cancelreminder</td>
                <td>Pings the bot operators to cancel a reminder that you no longer need.</td>
                <td>.cancelreminder (insert reminder message here)</td>
                <td>reminders</td>
            </tr>
            <tr>
                <td>.miraheze</td>
                <td>This command will tell you about Miraheze and where to learn more</td>
                <td></td>
                <td>miraheze</td>
            </tr>
            <tr>
                <td>.gethelp</td>
                <td>Pings Miraheze admins, prompting to help a user that needs help.</td>
                <td>.gethelp I cannot access https://www.meta.miraheze.org</td>
                <td>miraheze</td>
            </tr>
            <tr>
                <td>.python</td>
                <td>Tells you what version of Python ZppixBot is running.</td>
                <td>.python</td>
                <td>pyver</td>
            </tr>
            <tr>
                <td>.kickban<br />.kb</td>
                <td>This gives admins the ability to kickban a user.<br />The bot must be a Channel Operator for this command to work</td>
                <td>.kickban [#chan] user1 user!<em>@</em> get out of here</td>
                <td>channelmgmt</td>
            </tr>
            <tr>
                <td>.mangle</td>
                <td>Repeatedly translate the input until it makes no sense.</td>
                <td>.mangle this is a sentence</td>
                <td>translate</td>
            </tr>
            <tr>
                <td>.action</td>
                <td>Log an action in the meeting log<br /><a href="https://github.com/sopel-irc/sopel/wiki/Using-the-meetbot-module">https://github.com/sopel-irc/sopel/wiki/Using-the-meetbot-module</a></td>
                <td>.action elad will develop a meetbot</td>
                <td>meetbot</td>
            </tr>
            <tr>
                <td>.agreed</td>
                <td>Log an agreement in the meeting log.<br /><a href="https://github.com/sopel-irc/sopel/wiki/Using-the-meetbot-module">https://github.com/sopel-irc/sopel/wiki/Using-the-meetbot-module</a></td>
                <td>.agreed bowties are not cool</td>
                <td>meetbot</td>
            </tr>
            <tr>
                <td>.info</td>
                <td>Log an informational item in the meeting log<br /><a href="https://github.com/sopel-irc/sopel/wiki/Using-the-meetbot-module">https://github.com/sopel-irc/sopel/wiki/Using-the-meetbot-module</a></td>
                <td>.info all board members present</td>
                <td>meetbot</td>
            </tr>
            <tr>
                <td>.link</td>
                <td>Log a link in the meeting log.<br /><a href="https://github.com/sopel-irc/sopel/wiki/Using-the-meetbot-module">https://github.com/sopel-irc/sopel/wiki/Using-the-meetbot-module</a></td>
                <td>.link <a href="http://example.com">http://example.com</a></td>
                <td>meetbot</td>
            </tr>
            <tr>
                <td>.subject</td>
                <td>Change the meeting subject.<br /><a href="https://github.com/sopel-irc/sopel/wiki/Using-the-meetbot-module">https://github.com/sopel-irc/sopel/wiki/Using-the-meetbot-module</a></td>
                <td>.subject roll call</td>
                <td>meetbot</td>
            </tr>
            <tr>
                <td>.movie</td>
                <td>Returns some information about a movie, like Title, Year, Rating, Genre and IMDB Link.</td>
                <td>.movie Movie Title</td>
                <td>movie</td>
            </tr>
            <tr>
                <td>.part</td>
                <td>Part the specified channel. This is an admin-only command.</td>
                <td>.part #example</td>
                <td>admin</td>
            </tr>
            <tr>
                <td>.quiet</td>
                <td>This gives admins the ability to quiet a user.<br />The bot must be a Channel Operator for this command to work</td>
                <td>.quiet Example</td>
                <td>channelmgmt</td>
            </tr>
            <tr>
                <td>.quit</td>
                <td>Quit from the server. This is an owner-only command.</td>
                <td>.quit</td>
                <td>admin</td>
            </tr>
            <tr>
                <td>.rand</td>
                <td>
                    .rand &lt;arg1&gt; &lt;arg2&gt;
                    - Generates a random integer between
                    &lt;arg1&gt; and &lt;arg2&gt;.
                </td>
                <td>.rand 10 99</td>
                <td>rand</td>
            </tr>
            <tr>
                <td>.search</td>
                <td>Searches Google, Bing, and Duck Duck Go.</td>
                <td>.search nerdfighter</td>
                <td>search</td>
            </tr>
            <tr>
                <td>.seen</td>
                <td>Reports when and where the user was last seen.</td>
                <td>.seen example</td>
                <td>seen</td>
            </tr>
            <tr>
                <td>.tmask</td>
                <td>Set the mask to use for .topic in the current channel. %s is used to allow substituting in chunks of text.</td>
                <td></td>
                <td>channelmgmt</td>
            </tr>
            <tr>
                <td>.showmask</td>
                <td>Show the topic mask for the current channel.</td>
                <td></td>
                <td>channelmgmt</td>
            </tr>
            <tr>
                <td>.spellcheck</td>
                <td>Says whether the given word is spelled correctly, and gives suggestions if it&#39;s not.</td>
                <td>.spellcheck stuff</td>
                <td>spellcheck</td>
            </tr>
            <tr>
                <td>.startmeeting</td>
                <td>Start a meeting.<br /><a href="https://github.com/sopel-irc/sopel/wiki/Using-the-meetbot-module">https://github.com/sopel-irc/sopel/wiki/Using-the-meetbot-module</a></td>
                <td>.startmeeting title or .startmeeting</td>
                <td>meetbot</td>
            </tr>
            <tr>
                <td>.suggest</td>
                <td>Suggest terms starting with given input</td>
                <td></td>
                <td>search</td>
            </tr>
            <tr>
                <td>.t</td>
                <td>Returns the current time.</td>
                <td>.t UTC</td>
                <td>clock</td>
            </tr>
            <tr>
                <td>.topic</td>
                <td>This gives ops the ability to change the topic.</td>
                <td></td>
                <td>channelmgmt</td>
            </tr>
            <tr>
                <td>.translate</td>
                <td>Translates a phrase, with an optional language hint.</td>
                <td></td>
                <td>translate</td>
            </tr>
            <tr>
                <td>.unban</td>
                <td>This give admins the ability to unban a user.<br />The bot must be a Channel Operator for this command to work.</td>
                <td></td>
                <td>channelmgmt</td>
            </tr>
            <tr>
                <td>.unquiet</td>
                <td>This gives admins the ability to unquiet a user.<br />The bot must be a Channel Operator for this command to work</td>
                <td></td>
                <td>channelmgmt</td>
            </tr>
            <tr>
                <td>.setchanneltz</td>
                <td>Set the preferred time zone for the channel.</td>
                <td></td>
                <td>clock</td>
            </tr>
            <tr>
                <td>.setchanneltimeformat</td>
                <td>Sets your preferred format for time. Uses the standard strftime format. You can use <a href="http://strftime.net">http://strftime.net</a> or your favorite search engine to learn more.</td>
                <td>.setchanneltimeformat %FT%T%z</td>
                <td>clock</td>
            </tr>
            <tr>
                <td>.settz</td>
                <td>Set your preferred time zone. Most timezones will work, but it&#39;s best to use one from <a href="http://dft.ba/-tz">http://dft.ba/-tz</a></td>
                <td></td>
                <td>clock</td>
            </tr>
            <tr>
                <td>.settimeformat</td>
                <td>Sets your preferred format for time. Uses the standard strftime format. You can use <a href="http://strftime.net">http://strftime.net</a> or your favorite search engine to learn more.</td>
                <td>.settimeformat %FT%T%z</td>
                <td>clock</td>
            </tr>
            <tr>
                <td>.setlocation</td>
                <td>Set your default weather location.</td>
                <td>.setlocation Columbus, OH</td>
                <td>weather</td>
            </tr>
            <tr>
                <td>.version</td>
                <td>Tells you what version of Sopel ZppixBot is running.</td>
                <td></td>
                <td>version</td>
            </tr>
            <tr>
                <td>.weather</td>
                <td>.weather location - Show the weather at the given location.</td>
                <td>.weather London</td>
                <td>weather</td>
            </tr>
            <tr>
                <td>.w</td>
                <td>Look up something on Wikipedia</td>
                <td></td>
                <td>wikipedia</td>
            </tr>
            <tr>
                <td>.wt</td>
                <td>Look up a word on Wiktionary.</td>
                <td>.wt bailiwick</td>
                <td>wiktionary</td>
            </tr>
            <tr>
                <td>.xkcd</td>
                <td>.xkcd - Finds an xkcd comic strip. Takes one of 3 inputs:<br />If no input is provided it will return a random comic<br />If numeric input is provided it will return that comic<br />If non-numeric input is provided it will return the first google result for those keywords on the xkcd.com site</td>
                <td></td>
                <td>xkcd</td>
            </tr>
            <tr>
                <td>.add_known<br />.adduser</td>
                <td>.add_known &lt;username&gt; &lt;channel&gt; - will add username to known users list. Users from this list will not be welcomed upon joining the channel</td>
                <td>.add_known Zppix #miraheze</td>
                <td>welcome</td>
            </tr>
        </tbody>
    </table>
 
    <h1 id="module-development">Module development</h1>
    If you decided to extend ZppixBot with some functionality, you will need to create a new module.<br />
    This instruction will guide you through the process of custom module development<br />
    First of all, create a new file in <i>modules</i> directory with name <i>your_module.py</i><br />
    Bot modules are python scripts, so we shall start with importing required libraries (bot is using sopel) for your module to work. Here is the list of imports typically used:
 
<pre>
from __future__ import unicode_literals, absolute_import, print_function, division
import sopel
import sopel.module
import requests
import sopel.tools
from sopel.module import rule, priority, thread, commands, example
</pre>
 
    Let's define a function, which replies to ".hi" command with a greeting:
 
<pre>
@commands('hi')
def bot_hi(bot, trigger):
    bot.say('Hi ' + trigger.nick + '!')
</pre>
 
    <b>Explanation</b>: using <i>@commands</i> we specify which command bot should react to (in our case ".hi")<br />
    Handler function has two parameters:<br />
    <ul>
        <li>bot - bot instance, we use it to interact with chat (i.e. to send messages)</li>
        <li>trigger - provides us info about incoming command (text, sender, etc)</li>
    </ul>
    So in our example, we use <i>bot.say</i> to send message to the chat saying "hi, your_name!"<br />
    This is minimum required code for your module to function. You may try running it now.<br />
    <br />
    Unluckily, our bot will react only to ".hi" messages, but you may want it to react to ".hello" and ".hey" as well<br />
    In order to achieve that, we may set multiple command variations bot will respond to by specifying all of them in the decorator:
 
<pre>
<b>@commands('hi', 'hello', 'hey')</b>
def bot_hi(bot, trigger):
    bot.say('Hi ' + trigger.nick + '!')
</pre>
 
    You may try running that code and see that bot will react to all commands mentioned by saying "hi" to message sender.
    <br />
    Finally, you may want bot to accept some input from user. To demonstrate how to achieve that, let's develop a function which will welcome chat newcomers<br />
    For example, if John joins your chat, you may ask bot to welcome him with command ".welcome John" and bot will send a message saying "Welcome, John! Enjoy yourself in this chat!"<br />
    Similarly, you may ask bot to welcome Bob my saying ".welcome Bob" and bot will say "Welcome, Bob! Enjoy yourself in this chat!"<br />
    Let's also use <i>@example decorator</i> to provide command usage example:
 
<pre>
@commands('welcome')
@example('.welcome John')
def bot_welcome(bot, trigger):
    bot.say('Welcome ' + trigger.group(2) + '! Enjoy yourself in this chat!')
</pre>
 
    <b>Explanation</b>: we use <i>trigger.group(2)</i> to get the text after the command (in our example - name of user to welcome)<br />
    <br />
    Additionally, you may use <i>bot.reply</i>, which is similar to <i>bot.say</i>, but puts message sender name in the beginning of the message<br />
    To demonstrate that, let's create an "echo" function - it will send back to you your message, which will be starting with you name (i.e mention you):
 
<pre>
@commands('echo')
@example('.echo hello world!')
def bot_welcome(bot, trigger):
    bot.reply('You said: ' + trigger.group(2))
</pre>
 
    That was an example of simple module. We recommend you visiting <a href="https://github.com/sopel-irc/sopel/wiki">Sopel Wiki</a> for more info on this topic.<br />
    <br />
    Complete source code of this example (file <i>simple_module.py</i>):
 
<pre>
from __future__ import unicode_literals, absolute_import, print_function, division
import sopel
import sopel.module
import requests
import sopel.tools
from sopel.module import rule, priority, thread, commands, example
 
@commands('hi', 'hello', 'hey')
def bot_hi(bot, trigger):
    bot.say('Hi ' + trigger.nick + '!')
 
 
commands('welcome')
@example('.welcome John')
def bot_welcome(bot, trigger):
    bot.say('Welcome ' + trigger.group(2) + '! Enjoy yourself in this chat!')
 
 
@commands('echo')
@example('.echo hello world!')
def bot_welcome(bot, trigger):
    bot.reply('You said: ' + trigger.group(2))
</pre>
<h1 id="managing-bot">Managing the bot (for maintainers)</h1>
<h2 id="restarting-bot">Restarting the bot</h2>
To restart the bot first ssh to dev.tools.wmflabs.org.
<pre>ssh (your username)@dev.tools.wmflabs.org</pre>
Next become ZppixBot.
<pre>(your username)@tools-bastion-03:~$ become zppixbot</pre>
Next run the following command:
<pre>tools.zppixbot@tools-bastion-03:~$ kubectl get pods </pre> 
Then copy the line under the name column that starts with sopel.bot and only copy it till the last letter in that column line for that name.
Finally run the following command:
<pre>tools.zppixbot@tools-bastion-03:~$ kubectl delete pods sopel.bot-(enter what you copied from the last command)</pre>
The bot will quit from IRC and rejoin.
<h2 id="changing-modules">Making changes to modules</h2>
To make any module changes or additions, first commit the changes/additions on our GitHub repository.
Next SSH to Toolforge and become ZppixBot.
<pre>ssh (your username)@dev.tools.wmflabs.org
(your username)@tools-bastion-03:~$ become zppixbot
tools.zppixbot@tools-bastion-03:~$</pre>
Using the cd command, change your current working directory to ~/.sopel and once in said directory run git pull. This pulls in any new changes to the GitHub repository.
<pre>zppixbot@tools-bastion-03:~$ cd ~/.sopel
tools.zppixbot@tools-bastion-03:~/.sopel$ git pull</pre>
Finally connect to IRC and in a private message with ZppixBot say .reload and the bot will reload the module files. Saying "ZppixBot: reload" in any channel that ZppixBot is currently in will work as well.
<h2 id="config-changes">Making config changes</h2>
1. ssh to Toolforge and become ZppixBot<br/>
2. cd into ~/.sopel<br/>
3. Make any necessary changes to the config by editing default.cfg (ie: nano default.cfg or vim default.cfg) and save the file.<br/>
4. Restart the bot using the guide above.
<h2 id="cancel-reminder">Canceling a reminder</h2>
To cancel a reminder first connect to Toolforge and become ZppixBot.
<pre>ssh (your username)@dev.tools.wmflabs.org
(your username)@tools-bastion-03:~$ become zppixbot
tools.zppixbot@tools-bastion-03:~$</pre>
Next cd into ~/.sopel and edit ZppixBot-chat.freenode.net.reminders.db and remove the entry for the reminder you want to cancel, and save the file.
<pre>zppixbot@tools-bastion-03:~$ cd ~/.sopel
tools.zppixbot@tools-bastion-03:~/.sopel$ nano ZppixBot-chat.freenode.net.reminders.db</pre>
Finally reboot the bot using the guide above. (Note: you could also use vim)
<h2 id="update-website">Updating the website of ZppixBot</h2>
First push your changes to the repository on gerrit.wikimedia.org. Next ssh to Toolforge and become ZppixBot.
<pre>ssh (your username)@dev.tools.wmflabs.org
(your username)@tools-bastion-03:~$ become zppixbot
tools.zppixbot@tools-bastion-03:~$</pre>
Next cd into ~/ZppixBot and run git pull. This will pull in any new changes to the repository on gerrit.wikimedia.org.
<pre>tools.zppixbot@tools-bastion-03:~$ cd ~/ZppixBot
tools.zppixbot@tools-bastion-03:~/ZppixBot$ git pull</pre>
Go to tools.wmflabs.org and check to make sure your changes are present.
</html>
